# 效能指标驱动的过程设计

## 1. 系统概述

### 1.1 系统性质说明

**重要说明**：这是一个**模拟软件开发过程**的应用系统，不是真实的开发工具：

- **模拟性质**：所有开发过程都是模拟执行，不产生真实的代码、文档或产品
- **预定流程**：所有事件都是按预定流程触发，模拟真实开发中的各种情况
- **模拟数据**：所有效能指标都是基于模拟数据计算，用于演示和教学目的
- **应用场景**：主要用于过程演示、效能分析、培训教学和项目管理研究

### 1.2 手动/自动模式设计

根据`@手动自动的设计.md`的要求，手动和自动的区别在于：

**手动模式**：
- 项目创建时使用**手动输入**资源配置
- 每个环节结束后**手动触发**进入下一个流程
- 用户完全控制模拟过程的节奏

**自动模式**：
- 项目创建时使用**预设模板**进行资源配置
- 每个环节结束后**自动进入**下一个预定流程
- 系统按照预设节奏自动推进模拟过程

**混合模式**：
- 项目创建时可以选择模板或手动输入
- 关键节点需要用户确认，其他环节自动推进

## 2. 精选50个核心效能指标

基于阿里云效能度量指标，选择便于监控、便于设计事件、便于实现的50个核心指标：

### 2.1 研阶段指标（8个）

| 指标ID | 指标名称 | 度量价值 | 实现难度 |
|--------|----------|----------|----------|
| 45 | 新增需求趋势 | 需求输入稳定性 | 简单 |
| 54 | 新增需求概览 | 需求状态分布 | 简单 |
| 55 | 需求累积流图 | 需求流转效率 | 中等 |
| 56 | 存量需求占比 | 需求积压情况 | 简单 |
| 94 | 需求现状概览 | 需求执行状态 | 简单 |
| 41 | 存量工作项预估工时按项目排名 | 项目工作量评估 | 中等 |
| 69 | 预估工时按成员排名 | 个人工作量评估 | 中等 |
| 70 | 存量工作项按成员排名 | 个人任务分配 | 简单 |

### 2.2 建阶段指标（18个）

| 指标ID | 指标名称 | 度量价值 | 实现难度 |
|--------|----------|----------|----------|
| 20 | 代码提交趋势 | 开发活跃度 | 简单 |
| 21 | 提交按提交人趋势 | 个人贡献度 | 简单 |
| 81 | 代码提交按提交人排序 | 个人活跃度排名 | 简单 |
| 83 | 代码变更行趋势 | 代码变更规模 | 中等 |
| 95 | 代码变更概览 | 代码变更总览 | 简单 |
| 14 | 合并请求千行代码评论数趋势 | 代码评审质量 | 中等 |
| 15 | 合并请求评审趋势 | 评审活跃度 | 简单 |
| 17 | 合并请求趋势 | 代码集成效率 | 简单 |
| 19 | 合并请求概览 | 合并请求状态 | 简单 |
| 26 | 成功运行平均耗时按任务排名 | 任务执行效率 | 中等 |
| 27 | 失败率按任务排名 | 任务稳定性 | 简单 |
| 33 | 流水线运行失败率趋势 | 构建质量趋势 | 简单 |
| 34 | 流水线成功运行平均耗时趋势 | 构建效率趋势 | 中等 |
| 35 | 流水线成功运行频次趋势 | 构建频率 | 简单 |
| 40 | 运行概况 | 构建总体状况 | 简单 |
| 1 | 代码问题趋势 | 代码质量趋势 | 中等 |
| 12 | 存量问题按等级分布 | 问题严重程度 | 简单 |
| 13 | 代码问题概览 | 代码质量现状 | 简单 |

### 2.3 用阶段指标（8个）

| 指标ID | 指标名称 | 度量价值 | 实现难度 |
|--------|----------|----------|----------|
| 30 | 运行按流水线排名 | 部署频率 | 简单 |
| 37 | 流水线失败恢复分布 | 故障恢复能力 | 中等 |
| 39 | 最近一次运行状态 | 当前部署状态 | 简单 |
| 47 | 交付需求按阶段停留累积 | 交付流程效率 | 中等 |
| 51 | 需求交付效率概览 | 交付效率总览 | 中等 |
| 88 | 需求交付速率 | 交付速度分布 | 中等 |
| 90 | 需求交付分布 | 交付周期分布 | 中等 |
| 92 | 需求趋势 | 需求处理趋势 | 简单 |

### 2.4 管阶段指标（8个）

| 指标ID | 指标名称 | 度量价值 | 实现难度 |
|--------|----------|----------|----------|
| 3 | 工作项概览 | 工作项状态 | 简单 |
| 42 | 工作项排名 | 个人工作量 | 简单 |
| 68 | 项目进展 | 项目整体进展 | 中等 |
| 7 | 工时排名 | 个人工时投入 | 简单 |
| 8 | 工时投入排名 | 工时投入对比 | 简单 |
| 58 | 工时概览 | 工时总体状况 | 简单 |
| 4 | 迭代燃尽图 | 迭代进度跟踪 | 中等 |
| 64 | 迭代进展 | 迭代状态总览 | 中等 |

### 2.5 维阶段指标（8个）

| 指标ID | 指标名称 | 度量价值 | 实现难度 |
|--------|----------|----------|----------|
| 44 | 新增缺陷趋势 | 缺陷发现趋势 | 简单 |
| 52 | 新增缺陷概览 | 缺陷状态分布 | 简单 |
| 61 | 缺陷修复效率概览 | 修复效率总览 | 中等 |
| 73 | 存量缺陷趋势 | 缺陷积压趋势 | 简单 |
| 87 | 缺陷修复速率 | 修复速度分布 | 中等 |
| 91 | 缺陷趋势 | 缺陷整体趋势 | 简单 |
| 93 | 缺陷现状概览 | 缺陷当前状态 | 简单 |
| 96 | 代码库概览 | 代码库整体状况 | 中等 |

## 2. 50个关键指标分类与展示设计

### 2.1 指标分类与展示方式

| 指标分类 | 展示方式 | 数量 | 说明 |
|----------|----------|------|------|
| 趋势类指标 | 折线图 | 15个 | 显示时间序列变化趋势 |
| 排名类指标 | 排行榜 | 12个 | 显示个人/项目排名对比 |
| 分布类指标 | 饼图/柱状图 | 10个 | 显示状态分布情况 |
| 概览类指标 | 卡片/仪表盘 | 8个 | 显示总体状况概览 |
| 效率类指标 | 进度条/仪表盘 | 5个 | 显示效率百分比 |

### 2.2 关键指标预设值设计

#### 2.2.1 趋势类指标（15个）

| 指标ID | 指标名称 | 预设值范围 | 更新过程 | 展示方式 |
|--------|----------|------------|----------|----------|
| 45 | 新增需求趋势 | 2-8个/天 | 需求分析与收集 | 折线图 |
| 20 | 代码提交趋势 | 5-20次/天 | 编码实现 | 折线图 |
| 30 | 运行按流水线排名 | 1-5次/天 | 软件部署与发布 | 折线图 |
| 44 | 新增缺陷趋势 | 0.5-3个/天 | 问题诊断与修复 | 折线图 |
| 33 | 流水线运行失败率趋势 | 5%-25% | 构建与持续集成 | 折线图 |
| 34 | 流水线成功运行平均耗时趋势 | 5-30分钟 | 构建与持续集成 | 折线图 |
| 35 | 流水线成功运行频次趋势 | 2-10次/天 | 构建与持续集成 | 折线图 |
| 83 | 代码变更行趋势 | 200-1000行/天 | 编码实现 | 折线图 |
| 1 | 代码问题趋势 | 1-10个/天 | 测试与质量保证 | 折线图 |
| 73 | 存量缺陷趋势 | 5-50个 | 问题诊断与修复 | 折线图 |
| 87 | 缺陷修复速率 | 1-7天 | 问题诊断与修复 | 折线图 |
| 91 | 缺陷趋势 | 2-15个/周 | 问题诊断与修复 | 折线图 |
| 92 | 需求趋势 | 3-12个/周 | 用户反馈收集 | 折线图 |
| 88 | 需求交付速率 | 1-5个/周 | 用户反馈收集 | 折线图 |
| 90 | 需求交付分布 | 1-14天 | 用户反馈收集 | 折线图 |

#### 2.2.2 排名类指标（12个）

| 指标ID | 指标名称 | 预设值范围 | 更新过程 | 展示方式 |
|--------|----------|------------|----------|----------|
| 7 | 工时排名 | 30-60小时/周 | 团队协作管理 | 排行榜 |
| 8 | 工时投入排名 | 80%-120% | 团队协作管理 | 排行榜 |
| 21 | 提交按提交人趋势 | 2-15次/天 | 编码实现 | 排行榜 |
| 81 | 代码提交按提交人排序 | 10-100次/周 | 编码实现 | 排行榜 |
| 26 | 成功运行平均耗时按任务排名 | 2-45分钟 | 构建与持续集成 | 排行榜 |
| 27 | 失败率按任务排名 | 5%-30% | 构建与持续集成 | 排行榜 |
| 31 | 运行按触发方式排名 | 手动/自动 | 软件部署与发布 | 排行榜 |
| 32 | 运行按触发人排名 | 1-5人 | 软件部署与发布 | 排行榜 |
| 41 | 存量工作项预估工时按项目排名 | 100-800工时 | 项目启动与规划 | 排行榜 |
| 42 | 工作项排名 | 5-50个/人 | 详细设计与UI/UX设计 | 排行榜 |
| 58 | 工时概览 | 200-1000小时/项目 | 资源配置管理 | 排行榜 |
| 63 | 项目投入人力排名 | 3-20人 | 项目启动与规划 | 排行榜 |

#### 2.2.3 分布类指标（10个）

| 指标ID | 指标名称 | 预设值范围 | 更新过程 | 展示方式 |
|--------|----------|------------|----------|----------|
| 3 | 工作项概览 | 草稿30%/进行中40%/已完成30% | 项目启动与规划 | 饼图 |
| 19 | 合并请求概览 | 待审核10%/审核中60%/已合并30% | 编码实现 | 饼图 |
| 54 | 新增需求概览 | 草稿30%/评审中40%/已确认30% | 需求分析与收集 | 饼图 |
| 52 | 新增缺陷概览 | 新建20%/处理中30%/已修复30%/已关闭20% | 问题诊断与修复 | 饼图 |
| 12 | 存量问题按等级分布 | 低40%/中30%/高20%/严重10% | 测试与质量保证 | 饼图 |
| 36 | 成功运行的时段分布 | 工作时间80%/非工作时间20% | 软件部署与发布 | 柱状图 |
| 37 | 流水线失败恢复分布 | <5分钟10%/5-15分钟30%/15-30分钟40%/>30分钟20% | 软件部署与发布 | 饼图 |
| 38 | 流水线运行分布 | 2-10次/天 | 软件部署与发布 | 柱状图 |
| 56 | 存量需求占比 | 20%-60% | 需求分析与收集 | 饼图 |
| 93 | 缺陷现状概览 | 新建20%/处理中30%/已修复30%/已关闭20% | 问题诊断与修复 | 饼图 |

#### 2.2.4 概览类指标（8个）

| 指标ID | 指标名称 | 预设值范围 | 更新过程 | 展示方式 |
|--------|----------|------------|----------|----------|
| 40 | 运行概况 | 成功率85%-95% | 构建与持续集成 | 仪表盘 |
| 13 | 代码问题概览 | 总数20-100个 | 测试与质量保证 | 卡片 |
| 39 | 最近一次运行状态 | 成功/失败/运行中 | 软件部署与发布 | 状态卡片 |
| 94 | 需求现状概览 | 总数50-200个 | 需求分析与收集 | 卡片 |
| 96 | 代码库概览 | 代码行数10K-100K | 性能优化与功能增强 | 卡片 |
| 22 | 代码库语言分布 | Java40%/JS30%/Python20%/其他10% | 系统架构设计 | 饼图 |
| 78 | 代码库统计 | 文件数100-1000个 | 系统架构设计 | 卡片 |
| 95 | 代码变更概览 | 变更文件5-50个/天 | 编码实现 | 卡片 |

#### 2.2.5 效率类指标（5个）

| 指标ID | 指标名称 | 预设值范围 | 更新过程 | 展示方式 |
|--------|----------|------------|----------|----------|
| 68 | 项目进展 | 0%-100% | 项目进度管理 | 进度条 |
| 4 | 迭代燃尽图 | 剩余工作量0-100% | 项目进度管理 | 进度条 |
| 5 | 故事点燃尽图 | 剩余故事点0-100% | 项目进度管理 | 进度条 |
| 6 | 工时燃尽图 | 剩余工时0-100% | 项目进度管理 | 进度条 |
| 64 | 迭代进展 | 0%-100% | 项目进度管理 | 进度条 |

## 3. 关键行为设计

### 3.1 5个核心动态行为

基于角色交互时序图中的18个过程，选择50个关键指标，其中5个指标对应关键过程进行动态更新：

#### 3.1.1 任务2：市场调研与需求收集（研阶段）
**对应时序图过程**：任务2：市场调研与需求收集  
**关键指标**：指标45（新增需求趋势）  
**演示行为**：当项目演示到"需求文档提交"时，触发需求创建事件  
**前端展示**：右下角显示"需求分析师正在创建新需求..."，指标45实时+1  
**模拟数据**：
- 需求标题：从预设模板中随机选择
- 需求描述：基于模板生成详细描述
- 优先级：高/中/低（权重：20%/50%/30%）
- 故事点：1/2/3/5/8/13（权重分布）

#### 3.1.2 任务7：编码实现（建阶段）
**对应时序图过程**：任务7：编码实现（细化事件序列）  
**关键指标**：指标20（代码提交趋势）  
**演示行为**：当项目演示到"代码提交"时，触发代码提交事件  
**前端展示**：右下角显示"开发者正在提交代码..."，指标20实时+1  
**模拟数据**：
- 提交信息：从预设模板中随机选择
- 文件变更：1-10个文件
- 代码行数：新增50-500行，删除10-100行
- 提交者：从项目团队成员中随机选择

#### 3.1.3 任务10：软件部署与发布（用阶段）
**对应时序图过程**：任务10：软件部署与发布  
**关键指标**：指标30（运行按流水线排名）  
**演示行为**：当项目演示到"软件部署"时，触发部署执行事件  
**前端展示**：右下角显示"正在执行部署流水线..."，指标30实时+1  
**模拟数据**：
- 部署环境：开发/测试/生产
- 部署状态：成功/失败（成功率85%-95%）
- 执行时间：5-30分钟
- 触发方式：手动/自动

#### 3.1.4 任务17：团队协作管理（管阶段）
**对应时序图过程**：任务17：版本发布与迭代管理  
**关键指标**：指标7（工时排名）  
**演示行为**：当项目演示到"版本管理"时，触发工时记录事件  
**前端展示**：右下角显示"团队成员正在记录工时..."，指标7实时更新排名  
**模拟数据**：
- 工作时长：6-10小时/天
- 工作类型：开发/测试/设计/会议/文档
- 任务关联：关联到具体工作项
- 记录者：从项目团队成员中随机选择

#### 3.1.5 任务13：问题诊断与修复（维阶段）
**对应时序图过程**：任务13：问题诊断与修复  
**关键指标**：指标44（新增缺陷趋势）  
**演示行为**：当项目演示到"问题诊断"时，触发缺陷报告事件  
**前端展示**：右下角显示"测试人员正在报告缺陷..."，指标44实时+1  
**模拟数据**：
- 缺陷标题：从预设模板中随机选择
- 严重程度：低/中/高/严重（权重：40%/30%/20%/10%）
- 缺陷类型：功能/性能/界面/兼容性
- 报告者：测试人员/用户/开发人员

### 3.2 基于时序图演示流程的触发机制

#### 3.2.1 演示流程触发模式
```typescript
interface ProcessTrigger {
  processId: string;           // 对应时序图中的任务ID
  triggerEvent: string;       // 触发事件名称
  displayMessage: string;      // 前端右下角显示消息
  affectedMetrics: number[];   // 影响的指标ID列表
  simulationData: any;        // 模拟数据
}

// 5个关键过程的触发配置
const processTriggers: ProcessTrigger[] = [
  {
    processId: "task2",  // 任务2：市场调研与需求收集
    triggerEvent: "requirement_creation",
    displayMessage: "需求分析师正在创建新需求...",
    affectedMetrics: [45],
    simulationData: { /* 需求创建模拟数据 */ }
  },
  {
    processId: "task7",  // 任务7：编码实现
    triggerEvent: "code_commit",
    displayMessage: "开发者正在提交代码...",
    affectedMetrics: [20],
    simulationData: { /* 代码提交模拟数据 */ }
  },
  {
    processId: "task10", // 任务10：软件部署与发布
    triggerEvent: "deployment_execution",
    displayMessage: "正在执行部署流水线...",
    affectedMetrics: [30],
    simulationData: { /* 部署执行模拟数据 */ }
  },
  {
    processId: "task17", // 任务17：版本发布与迭代管理
    triggerEvent: "time_logging",
    displayMessage: "团队成员正在记录工时...",
    affectedMetrics: [7],
    simulationData: { /* 工时记录模拟数据 */ }
  },
  {
    processId: "task13", // 任务13：问题诊断与修复
    triggerEvent: "defect_reporting",
    displayMessage: "测试人员正在报告缺陷...",
    affectedMetrics: [44],
    simulationData: { /* 缺陷报告模拟数据 */ }
  }
];
```

#### 3.2.2 前端界面设计
```typescript
// 前端右下角事件显示组件
interface EventDisplayProps {
  currentProcess: string;      // 当前演示过程
  currentEvent: string;       // 当前事件
  displayMessage: string;     // 显示消息
  affectedMetrics: number[];  // 影响的指标
}

const EventDisplay: React.FC<EventDisplayProps> = ({
  currentProcess,
  currentEvent,
  displayMessage,
  affectedMetrics
}) => {
  return (
    <div className="event-display">
      <div className="current-process">
        当前过程：{currentProcess}
      </div>
      <div className="current-event">
        {displayMessage}
      </div>
      <div className="affected-metrics">
        影响指标：{affectedMetrics.join(', ')}
      </div>
    </div>
  );
};
```

#### 3.2.3 演示流程控制
```typescript
class ProcessSimulationController {
  private currentProcessIndex: number = 0;
  private processTriggers: ProcessTrigger[] = [];
  
  // 开始演示流程
  startSimulation() {
    this.executeProcess(this.processTriggers[this.currentProcessIndex]);
  }
  
  // 执行单个过程
  executeProcess(trigger: ProcessTrigger) {
    // 1. 更新前端界面显示当前过程
    this.updateProcessDisplay(trigger.processId);
    
    // 2. 触发关键事件（如果是5个关键过程之一）
    if (this.isKeyProcess(trigger.processId)) {
      this.triggerKeyEvent(trigger);
    }
    
    // 3. 更新相关指标
    this.updateMetrics(trigger.affectedMetrics);
    
    // 4. 显示右下角事件信息
    this.showEventDisplay(trigger);
  }
  
  // 触发关键事件
  private triggerKeyEvent(trigger: ProcessTrigger) {
    // 生成模拟数据
    const eventData = this.generateSimulationData(trigger.simulationData);
    
    // 更新指标
    this.updateDynamicMetrics(trigger.affectedMetrics, eventData);
    
    // 显示事件信息
    this.displayEventMessage(trigger.displayMessage);
  }
}
```

### 3.3 关键过程与指标更新关系

| 关键过程 | 时序图任务 | 影响指标 | 触发时机 | 前端展示 |
|----------|------------|----------|----------|----------|
| 需求创建 | 任务2：市场调研与需求收集 | 指标45 | 演示到"需求文档提交"时 | 右下角显示"需求分析师正在创建新需求..." |
| 代码提交 | 任务7：编码实现 | 指标20 | 演示到"代码提交"时 | 右下角显示"开发者正在提交代码..." |
| 部署执行 | 任务10：软件部署与发布 | 指标30 | 演示到"软件部署"时 | 右下角显示"正在执行部署流水线..." |
| 工时记录 | 任务17：版本发布与迭代管理 | 指标7 | 演示到"版本管理"时 | 右下角显示"团队成员正在记录工时..." |
| 缺陷报告 | 任务13：问题诊断与修复 | 指标44 | 演示到"问题诊断"时 | 右下角显示"测试人员正在报告缺陷..." |

### 3.4 其他指标更新机制

除了5个核心动态行为外，其他45个指标采用以下更新机制：

#### 3.4.1 过程结束时更新
- **更新时机**：每个过程完成时
- **更新方式**：基于预设规则生成数值
- **影响指标**：分布类、概览类、效率类指标

#### 3.4.2 阶段结束时更新
- **更新时机**：每个阶段完成时
- **更新方式**：基于阶段特征生成汇总数据
- **影响指标**：排名类指标

#### 3.4.3 项目结束时更新
- **更新时机**：整个项目完成时
- **更新方式**：基于项目整体情况生成最终数据
- **影响指标**：项目级汇总指标



## 5. 完整过程定义参考

### 5.1 18个完整过程列表

为了完整性，这里保留全部18个过程的定义作为参考：

#### 研阶段过程
1. **项目启动与规划** - 项目立项、团队组建、初步规划
2. **市场调研与需求收集** - 用户需求收集、市场分析
3. **技术可行性研究** - 技术方案评估、可行性分析
4. **竞品分析与概念验证** - 竞争对手分析、概念验证

#### 建阶段过程
5. **系统架构设计** - 整体架构设计、技术栈选型
6. **详细设计与UI/UX设计** - 详细设计文档、用户界面设计
7. **编码实现** - 代码开发、单元测试、代码评审（**核心动态过程**）
8. **测试与质量保证** - 集成测试、系统测试、质量保证
9. **构建与持续集成** - 自动化构建、持续集成配置

#### 用阶段过程
10. **软件部署与发布** - 生产环境部署、系统上线（**核心动态过程**）
11. **用户培训与推广** - 用户培训、系统推广
12. **用户反馈收集** - 用户反馈收集、使用数据分析

#### 管阶段过程（贯穿全周期）
13. **项目进度管理** - 进度跟踪、里程碑管理
14. **团队协作管理** - 团队协作、工时管理（**核心动态过程**）
15. **资源配置管理** - 资源分配、成本控制

#### 维阶段过程
16. **问题诊断与修复** - 缺陷发现、问题修复（**核心动态过程**）
17. **性能优化与功能增强** - 性能优化、功能改进
18. **持续改进与迭代管理** - 持续改进、迭代管理

### 5.2 事件触发机制与实现设计

**重要说明**：在简化实现中，只有5个核心过程会触发动态事件，其他过程结束时一次性更新相关指标。

每个动态事件的产生都有明确的触发条件和数据来源：

1. **模拟触发**：基于项目配置和时间进度自动生成模拟事件
2. **用户触发**：用户在手动模式下点击"执行下一步"时触发
3. **时间触发**：自动模式下基于预设时间间隔触发
4. **状态变更触发**：过程状态发生变化时触发相关事件

### 5.2 事件触发类型详细说明

#### 5.2.1 用户操作触发事件
这类事件由用户在前端界面的直接操作产生：

**典型事件**：
- `PROJECT_INITIATED` - 管理员创建项目
- `WORK_ITEM_CREATED` - 项目经理创建工作项
- `TASK_ASSIGNED` - 分配任务给团队成员
- `TIME_LOG_RECORDED` - 成员提交工时记录
- `DEFECT_REPORTED` - 测试人员报告缺陷

**实现机制**：
```typescript
// 前端操作触发事件
class UserActionEventTrigger {
  async createProject(projectData: ProjectData): Promise<void> {
    // 1. 验证用户权限
    await this.validateUserPermission(userId, 'create_project');
    
    // 2. 创建项目记录
    const project = await this.projectService.create(projectData);
    
    // 3. 生成事件
    const event = {
      eventId: 'PROJECT_INITIATED',
      projectId: project.id,
      timestamp: new Date(),
      triggeredBy: userId,
      data: projectData
    };
    
    // 4. 发布事件
    await this.eventBus.publish(event);
  }
}
```

#### 5.2.2 系统自动触发事件
这类事件由系统根据业务规则自动产生：

**典型事件**：
- `PROJECT_PROGRESS_UPDATED` - 任务完成时自动更新项目进度
- `REQUIREMENT_STATUS_CHANGED` - 工作流驱动的状态自动变更
- `BURNDOWN_DATA_UPDATED` - 每日自动更新燃尽图数据

**实现机制**：
```typescript
// 系统自动触发事件
class SystemAutoEventTrigger {
  // 监听任务完成事件，自动更新项目进度
  async onTaskCompleted(taskId: string): Promise<void> {
    const project = await this.getProjectByTask(taskId);
    const newProgress = await this.calculateProjectProgress(project.id);
    
    const event = {
      eventId: 'PROJECT_PROGRESS_UPDATED',
      projectId: project.id,
      timestamp: new Date(),
      triggeredBy: 'system',
      data: {
        previousProgress: project.progress,
        currentProgress: newProgress,
        triggeredByTask: taskId
      }
    };
    
    await this.eventBus.publish(event);
  }
}
```

#### 5.2.3 外部集成触发事件
这类事件由外部系统（如Git、CI/CD）通过API或Webhook触发：

**典型事件**：
- `CODE_COMMITTED` - Git提交触发
- `BUILD_TASK_FAILED` - CI/CD构建失败
- `DEPLOYMENT_PIPELINE_EXECUTED` - 部署系统执行

**实现机制**：
```typescript
// 外部系统集成事件触发
class ExternalIntegrationTrigger {
  // Git Webhook处理
  async handleGitWebhook(webhookData: GitWebhookData): Promise<void> {
    if (webhookData.event_type === 'push') {
      const event = {
        eventId: 'CODE_COMMITTED',
        projectId: this.getProjectIdFromRepo(webhookData.repository.url),
        timestamp: new Date(webhookData.timestamp),
        triggeredBy: webhookData.user_name,
        data: {
          commitId: webhookData.checkout_sha,
          author: webhookData.user_name,
          message: webhookData.commits[0].message,
          filesChanged: webhookData.total_commits_count,
          linesAdded: webhookData.commits[0].added?.length || 0,
          linesDeleted: webhookData.commits[0].removed?.length || 0
        }
      };
      
      await this.eventBus.publish(event);
    }
  }
}
```


## 6. 总结

### 6.1 设计核心思路

1. **基于时序图演示流程**：完全按照角色交互时序图中的18个过程进行演示
2. **5个关键过程动态更新**：选择5个关键过程，在演示到这些过程时触发动态指标更新
3. **前端右下角事件显示**：当演示到关键过程时，在界面右下角显示当前事件和影响指标
4. **45个静态指标**：其他指标在过程结束时基于预设规则更新
5. **完整覆盖50个指标**：确保所有关键指标都有对应的更新机制

### 6.2 关键设计特点

1. **演示流程清晰**：严格按照时序图的18个任务顺序进行演示
2. **关键过程突出**：5个关键过程在演示时会有特殊的事件显示和指标更新
3. **前端交互友好**：右下角实时显示当前事件，让用户清楚了解演示进度
4. **指标更新合理**：动态指标实时更新，静态指标过程结束时更新
5. **实现复杂度可控**：大幅简化事件复杂度，保持演示效果

### 6.3 技术实现优势

1. **流程控制精确**：基于时序图任务ID精确控制演示流程
2. **事件触发灵活**：支持手动和自动两种演示模式
3. **数据模拟真实**：基于预设模板生成真实的模拟数据
4. **界面展示直观**：右下角事件显示让用户清楚了解当前状态
5. **指标覆盖完整**：50个指标完整覆盖，满足演示需求
