# 效能指标定义文件

本文档定义了"研建用管维"模拟系统中使用的50个关键效能指标，包括其基本信息、所属阶段和过程、类型（动态或静态）、展示方式、以及如何进行赋值或计算。

## 1. 指标分类说明

### 1.1 指标分类与展示方式

| 指标分类 | 展示方式 | 数量 | 说明 |
|----------|----------|------|------|
| 趋势类指标 | 折线图 | 15个 | 显示时间序列变化趋势 |
| 排名类指标 | 排行榜 | 12个 | 显示个人/项目排名对比 |
| 分布类指标 | 饼图/柱状图 | 10个 | 显示状态分布情况 |
| 概览类指标 | 卡片/仪表盘 | 8个 | 显示总体状况概览 |
| 效率类指标 | 进度条/仪表盘 | 5个 | 显示效率百分比 |

### 1.2 动态指标（5个核心指标）
每个阶段选择1个最具标志性的指标，在模拟过程中动态更新：

| 阶段 | 指标ID | 指标名称 | 对应过程 | 更新触发 | 展示方式 |
|------|--------|----------|----------|----------|----------|
| 研 | metric_45 | 新增需求趋势 | 需求分析与收集 | requirement_creation行为 | 折线图 |
| 建 | metric_20 | 代码提交趋势 | 编码实现 | code_commit行为 | 折线图 |
| 用 | metric_30 | 运行按流水线排名 | 部署执行 | deployment_execution行为 | 折线图 |
| 管 | metric_7 | 工时排名 | 工时跟踪 | time_logging行为 | 排行榜 |
| 维 | metric_44 | 新增缺陷趋势 | 缺陷管理 | defect_reporting行为 | 折线图 |

### 1.3 静态指标（45个其他指标）
在对应过程结束时一次性赋值，基于预设规则生成：

## 2. 50个指标的详细配置（JSON格式）

### 2.1 指标分类配置

```json
{
  "metricCategories": {
    "trend": {
      "name": "趋势类指标",
      "displayType": "line_chart",
      "count": 15,
      "description": "显示时间序列变化趋势"
    },
    "ranking": {
      "name": "排名类指标", 
      "displayType": "ranking_table",
      "count": 12,
      "description": "显示个人/项目排名对比"
    },
    "distribution": {
      "name": "分布类指标",
      "displayType": "pie_chart",
      "count": 10,
      "description": "显示状态分布情况"
    },
    "overview": {
      "name": "概览类指标",
      "displayType": "card",
      "count": 8,
      "description": "显示总体状况概览"
    },
    "efficiency": {
      "name": "效率类指标",
      "displayType": "progress_bar",
      "count": 5,
      "description": "显示效率百分比"
    }
  }
}
```

### 2.2 5个核心动态指标配置

```json
{
  "coreDynamicMetrics": [
    {
      "id": "metric_45",
      "name": "新增需求趋势",
      "category": "trend",
      "phase": "research",
      "process": "requirement_analysis",
      "behavior": "requirement_creation",
      "presetRange": "2-8个/天",
      "updateFrequency": "real_time",
      "displayPosition": "top_center",
      "chartType": "line_chart"
    },
    {
      "id": "metric_20", 
      "name": "代码提交趋势",
      "category": "trend",
      "phase": "build",
      "process": "coding_implementation",
      "behavior": "code_commit",
      "presetRange": "5-20次/天",
      "updateFrequency": "real_time",
      "displayPosition": "top_center",
      "chartType": "line_chart"
    },
    {
      "id": "metric_30",
      "name": "运行按流水线排名", 
      "category": "trend",
      "phase": "use",
      "process": "deployment_execution",
      "behavior": "deployment_execution",
      "presetRange": "1-5次/天",
      "updateFrequency": "real_time",
      "displayPosition": "top_center",
      "chartType": "line_chart"
    },
    {
      "id": "metric_7",
      "name": "工时排名",
      "category": "ranking",
      "phase": "manage", 
      "process": "team_collaboration",
      "behavior": "time_logging",
      "presetRange": "30-60小时/周",
      "updateFrequency": "real_time",
      "displayPosition": "top_center",
      "chartType": "ranking_table"
    },
    {
      "id": "metric_44",
      "name": "新增缺陷趋势",
      "category": "trend",
      "phase": "maintain",
      "process": "problem_diagnosis",
      "behavior": "defect_reporting", 
      "presetRange": "0.5-3个/天",
      "updateFrequency": "real_time",
      "displayPosition": "top_center",
      "chartType": "line_chart"
    }
  ]
}
```

### 2.3 45个静态指标配置

```json
{
  "staticMetrics": {
    "distribution": [
      {
        "id": "metric_3",
        "name": "工作项概览",
        "phase": "research",
        "process": "project_planning",
        "presetValue": "草稿30%/进行中40%/已完成30%",
        "displayType": "pie_chart"
      },
      {
        "id": "metric_19",
        "name": "合并请求概览",
        "phase": "build", 
        "process": "code_review",
        "presetValue": "待审核10%/审核中60%/已合并30%",
        "displayType": "pie_chart"
      },
      {
        "id": "metric_54",
        "name": "新增需求概览",
        "phase": "research",
        "process": "requirement_analysis",
        "presetValue": "草稿30%/评审中40%/已确认30%",
        "displayType": "pie_chart"
      }
    ],
    "ranking": [
      {
        "id": "metric_21",
        "name": "提交按提交人趋势",
        "phase": "build",
        "process": "coding_implementation",
        "presetValue": "2-15次/天",
        "displayType": "ranking_table"
      },
      {
        "id": "metric_26",
        "name": "成功运行平均耗时按任务排名",
        "phase": "build",
        "process": "build_execution",
        "presetValue": "2-45分钟",
        "displayType": "ranking_table"
      },
      {
        "id": "metric_27",
        "name": "失败率按任务排名",
        "phase": "build",
        "process": "build_execution", 
        "presetValue": "5%-30%",
        "displayType": "ranking_table"
      }
    ],
    "overview": [
      {
        "id": "metric_40",
        "name": "运行概况",
        "phase": "build",
        "process": "build_execution",
        "presetValue": "成功率85%-95%",
        "displayType": "dashboard"
      },
      {
        "id": "metric_13",
        "name": "代码问题概览",
        "phase": "build",
        "process": "testing_qa",
        "presetValue": "总数20-100个",
        "displayType": "card"
      },
      {
        "id": "metric_39",
        "name": "最近一次运行状态",
        "phase": "use",
        "process": "deployment_execution",
        "presetValue": "成功/失败/运行中",
        "displayType": "status_card"
      }
    ],
    "efficiency": [
      {
        "id": "metric_68",
        "name": "项目进展",
        "phase": "manage",
        "process": "progress_management",
        "presetValue": "0%-100%",
        "displayType": "progress_bar"
      },
      {
        "id": "metric_4",
        "name": "迭代燃尽图",
        "phase": "manage",
        "process": "progress_management",
        "presetValue": "剩余工作量0-100%",
        "displayType": "progress_bar"
      },
      {
        "id": "metric_5",
        "name": "故事点燃尽图",
        "phase": "manage",
        "process": "progress_management",
        "presetValue": "剩余故事点0-100%",
        "displayType": "progress_bar"
      }
    ]
  }
}
```

## 3. 5个核心行为的配置和模拟数据

### 3.1 核心行为配置

```json
{
  "coreBehaviors": [
    {
      "name": "requirement_creation",
      "phase": "research",
      "process": "requirement_analysis",
      "frequency": "2-8次/天",
      "affectedMetrics": ["metric_45"],
      "simulationData": {
        "titleTemplates": ["用户登录功能", "数据导出功能", "报表生成功能"],
        "priorityDistribution": {"high": 0.2, "medium": 0.5, "low": 0.3},
        "storyPointDistribution": {"1": 0.1, "2": 0.2, "3": 0.3, "5": 0.2, "8": 0.15, "13": 0.05}
      }
    },
    {
      "name": "code_commit",
      "phase": "build", 
      "process": "coding_implementation",
      "frequency": "5-20次/天",
      "affectedMetrics": ["metric_20", "metric_21"],
      "simulationData": {
        "commitMessages": ["实现用户登录功能", "修复数据验证bug", "优化数据库查询性能"],
        "fileChanges": {"min": 1, "max": 10},
        "codeLines": {"added": {"min": 50, "max": 500}, "deleted": {"min": 10, "max": 100}}
      }
    },
    {
      "name": "deployment_execution",
      "phase": "use",
      "process": "deployment_execution", 
      "frequency": "1-5次/天",
      "affectedMetrics": ["metric_30"],
      "simulationData": {
        "environments": ["development", "testing", "production"],
        "successRate": {"min": 0.85, "max": 0.95},
        "executionTime": {"min": 5, "max": 30}
      }
    },
    {
      "name": "time_logging",
      "phase": "manage",
      "process": "team_collaboration",
      "frequency": "1次/人/天", 
      "affectedMetrics": ["metric_7", "metric_8"],
      "simulationData": {
        "workHours": {"min": 6, "max": 10},
        "workTypes": ["development", "testing", "design", "meeting", "documentation"]
      }
    },
    {
      "name": "defect_reporting",
      "phase": "maintain",
      "process": "problem_diagnosis",
      "frequency": "0.5-3次/天",
      "affectedMetrics": ["metric_44"],
      "simulationData": {
        "severityDistribution": {"low": 0.4, "medium": 0.3, "high": 0.2, "critical": 0.1},
        "defectTypes": ["functional", "performance", "ui", "compatibility"]
      }
    }
  ]
}
```

### 3.2 指标更新时机配置

```json
{
  "updateTriggers": {
    "realTime": {
      "description": "核心行为触发时实时更新",
      "metrics": ["metric_45", "metric_20", "metric_21", "metric_30", "metric_7", "metric_8", "metric_44"],
      "triggerEvents": ["requirement_creation", "code_commit", "deployment_execution", "time_logging", "defect_reporting"]
    },
    "processEnd": {
      "description": "过程完成时更新",
      "metrics": ["metric_3", "metric_19", "metric_54", "metric_52", "metric_12", "metric_36", "metric_37", "metric_38", "metric_56", "metric_93"],
      "triggerEvents": ["process_completed"]
    },
    "phaseEnd": {
      "description": "阶段完成时更新", 
      "metrics": ["metric_21", "metric_81", "metric_26", "metric_27", "metric_31", "metric_32", "metric_41", "metric_42", "metric_58", "metric_63"],
      "triggerEvents": ["phase_completed"]
    },
    "projectEnd": {
      "description": "项目完成时更新",
      "metrics": ["metric_40", "metric_13", "metric_39", "metric_94", "metric_96", "metric_22", "metric_78", "metric_95"],
      "triggerEvents": ["project_completed"]
    },
    "continuous": {
      "description": "持续更新",
      "metrics": ["metric_68", "metric_4", "metric_5", "metric_6", "metric_64"],
      "triggerEvents": ["progress_update"]
    }
  }
}
```

## 4. 指标配置生成规则

### 4.1 基于项目配置的预设值计算

```typescript
// 指标预设值计算器
class MetricPresetCalculator {
  // 根据项目配置计算指标预设值
  calculatePresetValue(metric: StaticMetric, projectConfig: ProjectConfig): any {
    const { presetValue } = metric;
    
    switch (presetValue.type) {
      case 'range':
        return this.calculateRangeValue(presetValue, projectConfig);
      case 'percentage':
        return this.calculatePercentageValue(presetValue, projectConfig);
      case 'distribution':
        return this.calculateDistributionValue(presetValue, projectConfig);
      case 'member_distribution':
        return this.calculateMemberDistribution(presetValue, projectConfig);
      case 'calculated':
        return this.calculateByRule(presetValue, projectConfig);
      default:
        return 0;
    }
  }
  
  private calculateRangeValue(presetValue: any, config: ProjectConfig): number {
    const { min, max, baseOn } = presetValue;
    let factor = 1;
    
    switch (baseOn) {
      case 'team_size':
        factor = config.teamSize / 10; // 以10人为基准
        break;
      case 'project_complexity':
        factor = config.complexity === 'high' ? 1.5 : config.complexity === 'medium' ? 1.0 : 0.7;
        break;
      case 'project_duration':
        factor = config.duration / 6; // 以6个月为基准
        break;
    }
    
    const adjustedMin = min * factor;
    const adjustedMax = max * factor;
    return Math.floor(Math.random() * (adjustedMax - adjustedMin + 1)) + adjustedMin;
  }
  
  private calculateMemberDistribution(presetValue: any, config: ProjectConfig): any[] {
    const { baseOn, calculation } = presetValue;
    const members = config.team.filter(member => member.role === baseOn);
    
    return members.map(member => {
      let factor = 1;
      switch (member.role) {
        case 'developer':
          factor = 1.2;
          break;
        case 'tester':
          factor = 0.8;
          break;
        case 'designer':
          factor = 0.9;
          break;
        default:
          factor = 1.0;
      }
      
      const baseValue = eval(calculation.replace('member_role_factor', factor));
      return {
        memberId: member.id,
        memberName: member.name,
        value: Math.floor(baseValue + Math.random() * 10)
      };
    });
  }
}
```

## 5. 总结

### 5.1 指标分类统计

- **动态指标**：5个（每个阶段1个核心指标）
- **静态指标**：45个（过程结束时一次性赋值）
- **总计**：50个效能指标

### 5.2 实现优势

1. **复杂度可控**：只有5个指标需要实时计算
2. **性能优化**：大部分指标使用预设值，响应快速
3. **维护简单**：清晰的指标分类和配置结构
4. **扩展性好**：易于添加新的指标类型

### 5.3 配置驱动

所有指标都通过配置文件定义，支持：
- 动态调整指标参数
- 灵活配置预设值规则
- 易于添加新指标
- 支持不同项目模板的指标配置

这种设计既保证了系统的完整性，又大大简化了实现复杂度，是一个很好的平衡方案。
