# 模拟系统设计说明

## 1. 系统性质与目标

### 1.1 系统定位

这是一个**模拟"研建用管维"软件开发过程**的演示应用，具有以下特点：

- **教学演示工具**：用于展示软件开发生命周期的完整过程
- **效能度量平台**：演示94个效能指标的计算和展示
- **过程模拟器**：模拟真实开发环境中的各种情况和事件
- **培训工具**：帮助团队理解开发过程和效能管理

### 1.2 模拟范围

**模拟内容**：
- 完整的"研建用管维"五个阶段流程
- 18个核心开发过程
- 200+个开发事件
- 94个效能指标计算
- 团队协作和项目管理

**不模拟内容**：
- 不产生真实的代码、文档或产品
- 不连接真实的Git、CI/CD等外部系统
- 不执行真实的构建、测试、部署操作

## 2. 手动/自动模式设计

### 2.1 模式区别说明

根据`@手动自动的设计.md`的要求，手动和自动的区别**不在于流程**，而在于：

#### 2.1.1 项目创建阶段
**手动模式**：
- 用户手动输入所有配置参数
- 团队规模、角色分配、预算、时间等
- 提供详细的配置界面和参数调整

**自动模式**：
- 使用预设的项目模板
- 小型项目模板：5人团队，3个月，50万预算
- 中型项目模板：10人团队，6个月，100万预算
- 大型项目模板：20人团队，12个月，300万预算

#### 2.1.2 过程执行阶段
**手动模式**：
- 每个阶段完成后需要用户手动点击"进入下一阶段"
- 可以暂停、继续、调整模拟参数
- 用户完全控制模拟节奏

**自动模式**：
- 系统按照预设时间间隔自动推进
- 研阶段：模拟2周，每2小时推进一个过程
- 建阶段：模拟4周，每4小时推进一个过程
- 用阶段：模拟1周，每1小时推进一个过程
- 管阶段：贯穿全程，每30分钟更新一次
- 维阶段：模拟2周，每3小时推进一个过程

### 2.2 混合模式设计

**混合模式**结合两种模式的优势：
- 项目创建时可以选择模板或手动配置
- 关键节点（如阶段切换、里程碑完成）暂停等待用户确认
- 非关键环节（如日常事件、指标更新）自动推进
- 提供"加速"、"减速"、"暂停"等控制选项

## 3. 模拟数据生成机制

### 3.1 事件触发模拟

**模拟原理**：
- 所有事件都按照预定的时间序列和逻辑关系触发
- 基于项目配置和随机算法生成模拟数据
- 确保数据的合理性和一致性

**事件生成规则**：
```typescript
// 事件生成器接口
interface EventGenerator {
  // 根据项目配置生成事件
  generateEvents(projectConfig: ProjectConfig): Event[];
  
  // 根据时间进度生成事件
  generateEventsByTime(projectId: string, timeProgress: number): Event[];
  
  // 根据阶段生成特定事件
  generatePhaseEvents(phase: PhaseType, projectId: string): Event[];
}

// 模拟事件生成器实现
class SimulationEventGenerator implements EventGenerator {
  generateEvents(projectConfig: ProjectConfig): Event[] {
    const events: Event[] = [];
    
    // 根据团队规模生成工作项
    const workItemCount = this.calculateWorkItemCount(projectConfig.teamSize);
    for (let i = 0; i < workItemCount; i++) {
      events.push(this.generateWorkItemEvent(projectConfig));
    }
    
    // 根据项目复杂度生成需求
    const requirementCount = this.calculateRequirementCount(projectConfig.complexity);
    for (let i = 0; i < requirementCount; i++) {
      events.push(this.generateRequirementEvent(projectConfig));
    }
    
    return events;
  }
  
  private calculateWorkItemCount(teamSize: number): number {
    // 基于团队规模计算工作项数量
    return Math.floor(teamSize * 8 + Math.random() * teamSize * 4);
  }
  
  private calculateRequirementCount(complexity: 'low' | 'medium' | 'high'): number {
    const baseCount = { low: 20, medium: 50, high: 100 };
    return baseCount[complexity] + Math.floor(Math.random() * 20);
  }
}
```

### 3.2 效能指标模拟

**指标计算模拟**：
- 基于模拟事件数据计算效能指标
- 使用预设的算法和公式
- 确保指标值的合理性和趋势性

**模拟算法示例**：
```typescript
// 代码提交趋势模拟
class CodeCommitTrendSimulator {
  simulateCodeCommits(projectConfig: ProjectConfig, timeRange: Date[]): CodeCommitEvent[] {
    const events: CodeCommitEvent[] = [];
    const developers = projectConfig.team.filter(member => member.role === 'developer');
    
    timeRange.forEach(date => {
      // 每个开发者每天提交1-5次代码
      developers.forEach(dev => {
        const commitCount = Math.floor(Math.random() * 5) + 1;
        for (let i = 0; i < commitCount; i++) {
          events.push({
            eventId: 'CODE_COMMITTED',
            projectId: projectConfig.id,
            timestamp: this.randomTimeInDay(date),
            triggeredBy: dev.id,
            data: {
              commitId: this.generateCommitId(),
              author: dev.name,
              message: this.generateCommitMessage(),
              filesChanged: Math.floor(Math.random() * 10) + 1,
              linesAdded: Math.floor(Math.random() * 200) + 10,
              linesDeleted: Math.floor(Math.random() * 50)
            }
          });
        }
      });
    });
    
    return events;
  }
  
  private generateCommitMessage(): string {
    const messages = [
      '实现用户登录功能',
      '修复数据验证bug',
      '优化数据库查询性能',
      '添加单元测试',
      '重构代码结构',
      '更新API文档',
      '修复内存泄漏问题'
    ];
    return messages[Math.floor(Math.random() * messages.length)];
  }
}
```

## 4. 模拟流程控制

### 4.1 时间控制机制

**模拟时间管理**：
```typescript
// 模拟时间控制器
class SimulationTimeController {
  private simulationSpeed: number = 1.0; // 模拟速度倍数
  private isPaused: boolean = false;
  private currentTime: Date = new Date();
  
  // 设置模拟速度
  setSimulationSpeed(speed: number): void {
    this.simulationSpeed = Math.max(0.1, Math.min(5.0, speed));
  }
  
  // 暂停/继续模拟
  togglePause(): void {
    this.isPaused = !this.isPaused;
  }
  
  // 推进模拟时间
  advanceTime(realTimeMs: number): void {
    if (!this.isPaused) {
      const simulatedTimeMs = realTimeMs * this.simulationSpeed;
      this.currentTime = new Date(this.currentTime.getTime() + simulatedTimeMs);
    }
  }
  
  // 获取当前模拟时间
  getCurrentSimulationTime(): Date {
    return this.currentTime;
  }
}
```

### 4.2 阶段推进控制

**阶段推进逻辑**：
```typescript
// 阶段推进控制器
class PhaseProgressionController {
  private currentPhase: PhaseType = 'research';
  private phaseStartTime: Date = new Date();
  private phaseDuration: Map<PhaseType, number> = new Map([
    ['research', 14 * 24 * 60 * 60 * 1000], // 14天
    ['build', 28 * 24 * 60 * 60 * 1000],    // 28天
    ['use', 7 * 24 * 60 * 60 * 1000],       // 7天
    ['manage', 0], // 贯穿全程
    ['maintain', 14 * 24 * 60 * 60 * 1000]  // 14天
  ]);
  
  // 检查是否可以进入下一阶段
  canAdvanceToNextPhase(): boolean {
    const elapsed = Date.now() - this.phaseStartTime.getTime();
    const duration = this.phaseDuration.get(this.currentPhase) || 0;
    return elapsed >= duration;
  }
  
  // 推进到下一阶段
  advanceToNextPhase(): PhaseType {
    const phaseOrder: PhaseType[] = ['research', 'build', 'use', 'maintain'];
    const currentIndex = phaseOrder.indexOf(this.currentPhase);
    
    if (currentIndex < phaseOrder.length - 1) {
      this.currentPhase = phaseOrder[currentIndex + 1];
      this.phaseStartTime = new Date();
    }
    
    return this.currentPhase;
  }
}
```

## 5. 用户交互设计

### 5.1 项目创建界面

**手动模式界面**：
```vue
<template>
  <div class="project-creation">
    <el-card title="创建模拟项目">
      <el-form :model="projectForm" label-width="120px">
        <!-- 基本信息 -->
        <el-form-item label="项目名称">
          <el-input v-model="projectForm.name" placeholder="请输入项目名称" />
        </el-form-item>
        
        <el-form-item label="项目类型">
          <el-select v-model="projectForm.type">
            <el-option label="Web应用" value="web" />
            <el-option label="移动应用" value="mobile" />
            <el-option label="桌面应用" value="desktop" />
            <el-option label="系统软件" value="system" />
          </el-select>
        </el-form-item>
        
        <!-- 团队配置 -->
        <el-form-item label="团队规模">
          <el-input-number v-model="projectForm.teamSize" :min="3" :max="50" />
        </el-form-item>
        
        <el-form-item label="角色分配">
          <el-table :data="roleAllocation" style="width: 100%">
            <el-table-column prop="role" label="角色" />
            <el-table-column prop="count" label="人数">
              <template #default="{ row }">
                <el-input-number v-model="row.count" :min="0" :max="20" />
              </template>
            </el-table-column>
          </el-table>
        </el-form-item>
        
        <!-- 项目参数 -->
        <el-form-item label="项目预算（万元）">
          <el-input-number v-model="projectForm.budget" :min="10" :max="1000" />
        </el-form-item>
        
        <el-form-item label="预计工期（月）">
          <el-input-number v-model="projectForm.duration" :min="1" :max="24" />
        </el-form-item>
        
        <el-form-item label="项目复杂度">
          <el-radio-group v-model="projectForm.complexity">
            <el-radio label="low">简单</el-radio>
            <el-radio label="medium">中等</el-radio>
            <el-radio label="high">复杂</el-radio>
          </el-radio-group>
        </el-form-item>
      </el-form>
    </el-card>
  </div>
</template>
```

**自动模式界面**：
```vue
<template>
  <div class="project-creation">
    <el-card title="选择项目模板">
      <el-row :gutter="20">
        <el-col :span="8">
          <el-card class="template-card" @click="selectTemplate('small')">
            <h3>小型项目</h3>
            <p>团队规模：5人</p>
            <p>预计工期：3个月</p>
            <p>预算：50万元</p>
            <p>适合：简单Web应用</p>
          </el-card>
        </el-col>
        
        <el-col :span="8">
          <el-card class="template-card" @click="selectTemplate('medium')">
            <h3>中型项目</h3>
            <p>团队规模：10人</p>
            <p>预计工期：6个月</p>
            <p>预算：100万元</p>
            <p>适合：企业级应用</p>
          </el-card>
        </el-col>
        
        <el-col :span="8">
          <el-card class="template-card" @click="selectTemplate('large')">
            <h3>大型项目</h3>
            <p>团队规模：20人</p>
            <p>预计工期：12个月</p>
            <p>预算：300万元</p>
            <p>适合：复杂系统</p>
          </el-card>
        </el-col>
      </el-row>
    </el-card>
  </div>
</template>
```

### 5.2 模拟控制界面

**模拟控制面板**：
```vue
<template>
  <div class="simulation-control">
    <el-card title="模拟控制">
      <div class="control-panel">
        <!-- 播放控制 -->
        <el-button-group>
          <el-button @click="play" :disabled="isPlaying">播放</el-button>
          <el-button @click="pause" :disabled="!isPlaying">暂停</el-button>
          <el-button @click="stop">停止</el-button>
          <el-button @click="reset">重置</el-button>
        </el-button-group>
        
        <!-- 速度控制 -->
        <div class="speed-control">
          <label>模拟速度：</label>
          <el-slider 
            v-model="simulationSpeed" 
            :min="0.1" 
            :max="5" 
            :step="0.1"
            style="width: 200px;"
          />
          <span>{{ simulationSpeed }}x</span>
        </div>
        
        <!-- 模式切换 -->
        <div class="mode-control">
          <el-radio-group v-model="simulationMode">
            <el-radio label="manual">手动模式</el-radio>
            <el-radio label="automatic">自动模式</el-radio>
            <el-radio label="mixed">混合模式</el-radio>
          </el-radio-group>
        </div>
        
        <!-- 当前状态 -->
        <div class="status-display">
          <p>当前阶段：{{ currentPhase }}</p>
          <p>模拟时间：{{ simulationTime }}</p>
          <p>项目进度：{{ projectProgress }}%</p>
        </div>
      </div>
    </el-card>
  </div>
</template>
```

## 6. 数据持久化设计

### 6.1 模拟数据存储

**模拟项目数据结构**：
```typescript
interface SimulationProject {
  id: string;
  name: string;
  type: 'web' | 'mobile' | 'desktop' | 'system';
  mode: 'manual' | 'automatic' | 'mixed';
  config: ProjectConfig;
  status: 'created' | 'running' | 'paused' | 'completed';
  currentPhase: PhaseType;
  phaseStartTime: Date;
  simulationSpeed: number;
  events: SimulationEvent[];
  metrics: MetricValue[];
  createdAt: Date;
  updatedAt: Date;
}

interface ProjectConfig {
  teamSize: number;
  teamMembers: TeamMember[];
  budget: number;
  duration: number; // 月
  complexity: 'low' | 'medium' | 'high';
  template?: 'small' | 'medium' | 'large';
}

interface SimulationEvent {
  id: string;
  eventId: string;
  projectId: string;
  timestamp: Date;
  phase: PhaseType;
  process: string;
  triggeredBy: string;
  data: any;
  simulated: boolean; // 标识是否为模拟事件
}
```

### 6.2 状态恢复机制

**模拟状态恢复**：
```typescript
// 模拟状态管理器
class SimulationStateManager {
  // 保存模拟状态
  async saveSimulationState(projectId: string, state: SimulationState): Promise<void> {
    await this.database.simulationStates.upsert({
      projectId,
      state: JSON.stringify(state),
      updatedAt: new Date()
    });
  }
  
  // 恢复模拟状态
  async restoreSimulationState(projectId: string): Promise<SimulationState | null> {
    const record = await this.database.simulationStates.findByProjectId(projectId);
    if (record) {
      return JSON.parse(record.state);
    }
    return null;
  }
  
  // 重置模拟状态
  async resetSimulationState(projectId: string): Promise<void> {
    await this.database.simulationStates.deleteByProjectId(projectId);
    await this.database.simulationEvents.deleteByProjectId(projectId);
    await this.database.metricValues.deleteByProjectId(projectId);
  }
}
```

## 7. 总结

### 7.1 模拟系统特点

1. **教学导向**：专门用于演示和教学，不产生真实产品
2. **流程完整**：完整模拟"研建用管维"五个阶段
3. **数据真实**：基于真实开发经验生成合理的模拟数据
4. **交互灵活**：支持手动、自动、混合三种模式
5. **指标准确**：基于真实指标公式计算效能数据

### 7.2 应用价值

1. **过程演示**：清晰展示软件开发的完整过程
2. **效能教学**：帮助理解效能指标的含义和计算方法
3. **团队培训**：提升团队对开发过程的认识
4. **管理研究**：为项目管理研究提供数据支持
5. **工具验证**：验证效能度量工具的有效性

通过这种模拟系统设计，可以有效地演示"研建用管维"开发过程，帮助用户理解效能指标的计算和应用，为真实的项目管理提供参考和指导。
